[
    {
        "nl_query": "Analyse the following webpage's CTR and total visitors. Break it down by market",
        "sql": "DECLARE start_date_pre_change DATE DEFAULT DATE('2025-01-01');\nDECLARE end_date_post_change DATE DEFAULT DATE('2025-01-28');\n\nWITH CTE_sessions AS (\n    SELECT DISTINCT\n        h.market_code,\n        h.visitor_id,\n        h.session_id,\n        h.page_path,\n        s.bounced_session,\n        s.device_category,\n        s.channel_grouping,\n        s.medium,\n        h.hit_datetime AS visit_datetime,\n        h.visit_start_date\n    FROM `jlr-dl-dxa.PRD_GA4.GA4_hit` h\n    LEFT JOIN `jlr-dl-dxa.PRD_GA4.GA4_session` s\n        ON h.session_id = s.session_id\n    WHERE \n        h.visit_start_date BETWEEN start_date_pre_change AND end_date_post_change\n        AND s.visit_start_date BETWEEN start_date_pre_change AND end_date_post_change\n        AND h.market_code IN (\"US\", 'CA', 'GB')\n        AND h.page_path IN ('www.landrover.co.uk/index.html', 'www.landroverusa.com/index.html', 'www.landrover.ca/en/index.html',\n                             'www.landroverusa.com/range-rover/index.html', 'www.landroverusa.com/defender/index.html', 'www.landroverusa.com/discovery/index.html',\n                             \"www.landrover.co.uk/range-rover/index.html\", \"www.landrover.co.uk/defender/index.html\", \"www.landrover.co.uk/discovery/index.html\",\n                             \"www.landrover.ca/en/range-rover/index.html\", \"www.landrover.ca/en/defender/index.html\", \"www.landrover.ca/en/discovery/index.html\")\n        AND h.brand = \"Land Rover\"\n),\n\nCTE_events AS (\n    SELECT\n        s.market_code,\n        s.visitor_id,\n        s.device_category,\n        s.channel_grouping,\n        s.medium,\n        s.visit_start_date,\n        s.session_id,\n        hit.hit_datetime,\n        hit.page_path,\n        CASE \n            WHEN event_label IN (\n                'JOIN THE WAITING LIST :: cta-content',\n                'KEEP ME INFORMED :: cta-content',\n                'FIND OUT MORE :: cta-content',\n                'BUILD YOUR OWN :: cta-content',\n                'BUILD AND ORDER :: secondary-link None',\n                'EXPLORE :: cta-content',\n                'BUILD AND ORDER :: cta-content',\n                'BOOK YOUR TEST DRIVE :: secondary-link None',\n                'CHECK AVAILABILITY :: secondary-link None',\n                'EXPLORE FINANCE OPTIONS :: secondary-link None',\n                'BUILD AND RESERVE :: cta-content',\n                'LEARN MORE :: cta-content',\n                'BUILD AND RESERVE :: secondary-link None',\n                'ENTER :: HouseOfBrandHome__single-cta'\n            ) THEN 'CTR'\n        END AS event_type,\n        CASE \n            WHEN s.bounced_session = 1 THEN hit.visitor_id\n        END AS bounced_visitor\n    FROM CTE_sessions s\n    JOIN `jlr-dl-dxa.PRD_GA4.GA4_hit` hit\n        ON s.session_id = hit.session_id\n        AND hit.hit_datetime > s.visit_datetime\n)\n\nSELECT\n    rc.market_code,\n    rc.page_path, \n    rc.device_category,\n    rc.channel_grouping,\n    rc.medium, \n    COUNT(DISTINCT rc.visitor_id) AS total_page_visitors,\n    COUNT(DISTINCT CASE WHEN e.event_type = 'CTR' THEN e.visitor_id END) AS CTR,\n    COUNT(DISTINCT e.bounced_visitor) AS total_bounced_visitor\nFROM CTE_sessions rc\nLEFT JOIN CTE_events e \n    ON rc.visitor_id = e.visitor_id \n    AND rc.page_path = e.page_path\n    AND rc.visit_start_date = e.visit_start_date\nGROUP BY 1,2,3,4,5;"
    },
    {
        "nl_query": "Get the list of all orders placed in the last month.",
        "sql": "SELECT * FROM orders WHERE order_date >= DATE_SUB(CURDATE(), INTERVAL 1 MONTH);"
    },
    {
        "nl_query": "Find the email addresses of users who have placed more than five orders.",
        "sql": "SELECT u.email FROM users u JOIN orders o ON u.id = o.user_id GROUP BY u.email HAVING COUNT(o.order_id) > 5;"
    },
    {
        "nl_query": "List all products and their total quantities sold.",
        "sql": "SELECT product, SUM(quantity) AS total_sold FROM orders GROUP BY product;"
    },
    {
        "nl_query": "I want a breakdown of range rover sport by channel",
        "sql": "SELECT h.market_code, s.campaign, s.channel_grouping, s.medium, s.referrer, DATE_TRUNC(h.visit_start_date, WEEK) AS week, h.visit_start_date, COUNT(DISTINCT h.visitor_id) AS total_users FROM `jlr-dl-dxa.PRD_GA4.GA4_hit` h LEFT JOIN `jlr-dl-dxa.PRD_GA4.GA4_session` s ON h.session_id = s.session_id WHERE h.visit_start_date BETWEEN DATE('2024-09-01') AND DATE('2024-09-01') AND s.visit_start_date BETWEEN DATE('2024-09-01') AND DATE('2024-09-01') AND h.brand = 'Land Rover' AND page_path LIKE '%range-rover/range-rover-sport/index.html' GROUP BY 1,2,3,4,5,6,7"
    }
]
